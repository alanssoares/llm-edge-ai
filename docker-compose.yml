# This file is generated by generate-compose.py
# To regenerate: python3 generate-compose.py --devices 5 --mqtt-enabled
# Number of devices: 5
# MQTT telemetry: enabled

services:
  mqtt-broker:
    image: eclipse-mosquitto:2.0
    container_name: mqtt-broker
    hostname: mqtt-broker
    ports:
    - 1883:1883
    - 9001:9001
    volumes:
    - ./config/mosquitto.conf:/mosquitto/config/mosquitto.conf:ro
    - mosquitto_data:/mosquitto/data
    - mosquitto_logs:/mosquitto/log
    networks:
    - edge-network
    restart: unless-stopped
    command: mosquitto -c /mosquitto/config/mosquitto.conf
  iot-device-image:
    build:
      context: .
      dockerfile: Dockerfile
    image: iot-device-simulator:latest
    command:
    - echo
    - This service builds the shared image
  edge-device-01:
    image: iot-device-simulator:latest
    container_name: edge-device-01
    hostname: edge-device-01
    environment:
    - DEVICE_NAME=edge-device-01
    - DEVICE_ID=00:0f:00:70:91:0a
    - MQTT_BROKER=mqtt-broker
    - MQTT_PORT=1883
    volumes:
    - ./config:/etc/edge-device:ro
    networks:
    - edge-network
    depends_on:
    - mqtt-broker
    - iot-device-image
    restart: unless-stopped
  edge-device-02:
    image: iot-device-simulator:latest
    container_name: edge-device-02
    hostname: edge-device-02
    environment:
    - DEVICE_NAME=edge-device-02
    - DEVICE_ID=1c:bf:ce:15:ec:4d
    - MQTT_BROKER=mqtt-broker
    - MQTT_PORT=1883
    volumes:
    - ./config:/etc/edge-device:ro
    networks:
    - edge-network
    depends_on:
    - mqtt-broker
    - iot-device-image
    restart: unless-stopped
  edge-device-03:
    image: iot-device-simulator:latest
    container_name: edge-device-03
    hostname: edge-device-03
    environment:
    - DEVICE_NAME=edge-device-03
    - DEVICE_ID=b8:27:eb:bf:9d:51
    - MQTT_BROKER=mqtt-broker
    - MQTT_PORT=1883
    volumes:
    - ./config:/etc/edge-device:ro
    networks:
    - edge-network
    depends_on:
    - mqtt-broker
    - iot-device-image
    restart: unless-stopped
  edge-device-04:
    image: iot-device-simulator:latest
    container_name: edge-device-04
    hostname: edge-device-04
    environment:
    - DEVICE_NAME=edge-device-04
    - DEVICE_ID=00:0f:00:70:91:0a
    - MQTT_BROKER=mqtt-broker
    - MQTT_PORT=1883
    volumes:
    - ./config:/etc/edge-device:ro
    networks:
    - edge-network
    depends_on:
    - mqtt-broker
    - iot-device-image
    restart: unless-stopped
  edge-device-05:
    image: iot-device-simulator:latest
    container_name: edge-device-05
    hostname: edge-device-05
    environment:
    - DEVICE_NAME=edge-device-05
    - DEVICE_ID=1c:bf:ce:15:ec:4d
    - MQTT_BROKER=mqtt-broker
    - MQTT_PORT=1883
    volumes:
    - ./config:/etc/edge-device:ro
    networks:
    - edge-network
    depends_on:
    - mqtt-broker
    - iot-device-image
    restart: unless-stopped
volumes:
  mosquitto_data:
    driver: local
  mosquitto_logs:
    driver: local
networks:
  edge-network:
    driver: bridge
    ipam:
      config:
      - subnet: 172.20.0.0/16
